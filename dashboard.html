<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- iOS PWA Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wydatki">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#F2F2F7">
    <meta name="theme-color" content="#1C1C1E" media="(prefers-color-scheme: dark)">
    
    <title>Dashboard Wydatk√≥w</title>
    
    <!-- PWA Icons & Manifest -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/main.css?v2.1">
    <link rel="stylesheet" href="/css/yearly-chart.css?v-1">
   <!-- Stylesheets -->
    
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-logo" role="img" aria-label="Ikona aplikacji">üí∞</div>
            <div class="loading-spinner" aria-hidden="true"></div>
            <p class="loading-text">≈Åadowanie wydatk√≥w...</p>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="appContainer">
        <!-- Navigation Header -->
        <header class="nav-header" id="navHeader">
            <div class="nav-content">
                <h1 class="nav-title" id="navTitle">Wydatki</h1>
                <div class="nav-actions">
                    <button class="nav-button" id="refreshBtn" aria-label="Od≈õwie≈º dane">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <polyline points="1 20 1 14 7 14"></polyline>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Date Selector -->
            <div class="date-selector">
                <div class="date-tiles">
                    <div class="date-tile">
                        <label class="date-label">Rok</label>
                        <select class="date-select" id="yearSelect" aria-label="Wybierz rok">
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                    <div class="date-tile">
                        <label class="date-label">MiesiƒÖc</label>
                        <select class="date-select" id="monthSelect" aria-label="Wybierz miesiƒÖc">
                            <option value="01">Stycze≈Ñ</option>
                            <option value="02">Luty</option>
                            <option value="03">Marzec</option>
                            <option value="04">Kwiecie≈Ñ</option>
                            <option value="05">Maj</option>
                            <option value="06">Czerwiec</option>
                            <option value="07">Lipiec</option>
                            <option value="08">Sierpie≈Ñ</option>
                            <option value="09">Wrzesie≈Ñ</option>
                            <option value="10">Pa≈∫dziernik</option>
                            <option value="11">Listopad</option>
                            <option value="12">Grudzie≈Ñ</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <!-- Pull to Refresh Indicator -->
        <div class="pull-to-refresh" id="pullToRefresh">
            <div class="refresh-indicator">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                </svg>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view-content">
                <!-- Summary Cards -->
                <section class="summary-grid">
                    <div class="summary-card private" data-category="Prywatne" role="button" tabindex="0">
                        <span class="summary-card-icon" aria-hidden="true">üè†</span>
                        <h3 class="summary-card-title">Prywatne</h3>
                        <div class="summary-card-amount">0 z≈Ç</div>
                        <div class="summary-card-subtitle">0 transakcji</div>
                    </div>

                    <div class="summary-card mthub" data-category="MT HUB" role="button" tabindex="0">
                        <span class="summary-card-icon" aria-hidden="true">üîß</span>
                        <h3 class="summary-card-title">MT HUB</h3>
                        <div class="summary-card-amount">0 z≈Ç</div>
                        <div class="summary-card-subtitle">0 transakcji</div>
                    </div>

                    <div class="summary-card fhu" data-category="FHU" role="button" tabindex="0">
                        <span class="summary-card-icon" aria-hidden="true">‚õΩ</span>
                        <h3 class="summary-card-title">FHU</h3>
                        <div class="summary-card-amount">0 z≈Ç</div>
                        <div class="summary-card-subtitle">0 transakcji</div>
                    </div>
                </section>

                <!-- Chart Section -->
                <section class="card">
                    <div class="card-header">
                        <h2 class="card-title">Podzia≈Ç wydatk√≥w</h2>
                        <p class="card-subtitle">Wizualizacja kategorii w bie≈ºƒÖcym miesiƒÖcu</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="expenseChart" role="img" aria-label="Wykres ko≈Çowy przedstawiajƒÖcy podzia≈Ç wydatk√≥w wed≈Çug kategorii"></canvas>
                    </div>
                </section>

                <!-- Stats Row -->
                <section class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="totalExpenses">0 z≈Ç</div>
                        <div class="stat-label">≈ÅƒÖczne wydatki</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="transactionCount">0</div>
                        <div class="stat-label">Transakcje</div>
                    </div>
                </section>

                <!-- Recent Transactions Preview -->
                <section class="card">
                    <div class="card-header">
                        <h2 class="card-title">Ostatnie transakcje</h2>
                        <p class="card-subtitle">Zobacz wiƒôcej w zak≈Çadkach kategorii</p>
                    </div>
                    <div class="card-content">
                        <div id="recentTransactionsList">
                            <div class="empty-state">
                                <div class="empty-icon">üìù</div>
                                <div class="empty-title">Brak transakcji</div>
                                <div class="empty-subtitle">Nie znaleziono ostatnich transakcji</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Yearly Chart Section -->
                <section class="card" id="yearlyChartSection">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Wydatki w roku</h2>
                            <p class="card-subtitle">Analiza trend√≥w miesiƒôcznych wed≈Çug kategorii</p>
                        </div>
                        
                        <div class="yearly-chart-controls">
                            <!-- Chart Type Switcher -->
                            <div class="chart-type-switcher">
                                <button class="chart-type-button active" 
                                        data-type="line" 
                                        id="chartTypeLineBtn"
                                        aria-label="Wykres liniowy">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <polyline points="22,6 13,13 8.5,8.5 2,15"></polyline>
                                        <polyline points="16,6 22,6 22,12"></polyline>
                                    </svg>
                                    Liniowy
                                </button>
                                <button class="chart-type-button" 
                                        data-type="bar" 
                                        id="chartTypeBarBtn"
                                        aria-label="Wykres s≈Çupkowy">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <rect x="7" y="8" width="3" height="8"></rect>
                                        <rect x="14" y="6" width="3" height="10"></rect>
                                    </svg>
                                    S≈Çupkowy
                                </button>
                            </div>
                            
                            <!-- Load Button -->
                            <button class="yearly-load-button" 
                                    id="loadYearlyChartBtn"
                                    aria-label="Za≈Çaduj wykres roczny">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <rect x="7" y="8" width="3" height="8"></rect>
                                    <rect x="14" y="6" width="3" height="10"></rect>
                                </svg>
                                Za≈Çaduj wykres
                            </button>
                        </div>
                    </div>
                     
                    <!-- Chart Container -->
                    <div class="yearly-chart-container">
                        <canvas id="yearlyExpenseChart" 
                                role="img" 
                                aria-label="Wykres roczny wydatk√≥w wed≈Çug kategorii">
                        </canvas>
                    </div>
                </section>

                <!-- Yearly Stats - Row 1 -->
                <section class="stats-row yearly-stats-card" 
                         style="display: none;" 
                         aria-label="Podstawowe statystyki roczne">
                    <div class="stat-card">
                        <div class="stat-value" id="totalYearlyExpenses">0 z≈Ç</div>
                        <div class="stat-label">Wydatki w roku</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgMonthlyExpenses">0 z≈Ç</div>
                        <div class="stat-label">≈örednia miesiƒôczna</div>
                    </div>
                </section>

                <!-- Yearly Stats - Row 2 -->
                <section class="stats-row yearly-stats-card" 
                         style="display: none;"
                         aria-label="Miesiƒôczne ekstrema">
                    <div class="stat-card">
                        <div class="stat-value" id="highestMonthExpenses">-</div>
                        <div class="stat-label">Najwy≈ºszy miesiƒÖc</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="lowestMonthExpenses">-</div>
                        <div class="stat-label">Najni≈ºszy miesiƒÖc</div>
                    </div>
                </section>
            </div>

            <!-- Category Views (Hidden by default) -->
            <div id="categoryViews" class="hidden">
                <!-- Will be populated dynamically -->
            </div>
        </main>

        <!-- Bottom Sheet for Transaction Details -->
        <div class="sheet-backdrop" id="sheetBackdrop"></div>
        <div class="bottom-sheet" id="transactionSheet">
            <div class="bottom-sheet-handle" id="sheetHandle"></div>
            <div class="bottom-sheet-header">
                <h2 class="bottom-sheet-title" id="sheetTitle">Transakcje</h2>
                <button class="close-button" id="closeSheet" aria-label="Zamknij">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="bottom-sheet-content" id="sheetContent">
                <!-- Transaction list will be populated here -->
            </div>
        </div>

        <!-- Tab Bar -->
        <nav class="tab-bar" role="tablist">
            <div class="tab-bar-content">
                <button class="tab-item active" id="dashboardTab" data-view="dashboard" role="tab" aria-selected="true">
                    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span class="tab-label">Start</span>
                </button>

                <button class="tab-item" id="privateTab" data-category="Prywatne" role="tab" aria-selected="false">
                    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9,22 9,12 15,12 15,22"></polyline>
                    </svg>
                    <span class="tab-label">Prywatne</span>
                </button>

                <button class="tab-item add-expense-btn" id="addExpenseTab" role="tab" aria-selected="false">
                    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span class="tab-label">Dodaj</span>
                </button>

                <button class="tab-item" id="mthubTab" data-category="MT HUB" role="tab" aria-selected="false">
                    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                    </svg>
                    <span class="tab-label">MT HUB</span>
                </button>

                <button class="tab-item" id="fhuTab" data-category="FHU" role="tab" aria-selected="false">
                    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M6 2L3 6v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V6l-3-4H6zM3.8 6h16.4M16 10a4 4 0 1 1-8 0"/>
                    </svg>
                    <span class="tab-label">FHU</span>
                </button>
            </div>
        </nav>

        <!-- Add Expense Sheet -->
        <div class="sheet-backdrop" id="addExpenseBackdrop"></div>
        <div class="bottom-sheet" id="addExpenseSheet">
            <div class="bottom-sheet-handle" id="addExpenseHandle"></div>
            <div class="bottom-sheet-header">
                <h2 class="bottom-sheet-title">Dodaj wydatek</h2>
                <button class="close-button" id="closeAddExpense" aria-label="Zamknij">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="bottom-sheet-content">
                <form id="addExpenseForm" class="expense-form">
                    <!-- Category -->
                    <div class="form-group">
                        <label class="form-label">Kategoria</label>
                        <div class="segmented-control">
                            <button type="button" class="segment-button active" data-category="Prywatne">
                                Prywatne
                            </button>
                            <button type="button" class="segment-button" data-category="Firmowe">
                                Firmowe
                            </button>
                        </div>
                    </div>

                    <!-- Subcategory (for Prywatne) -->
                    <div class="form-group" id="subcategoryGroup">
                        <label class="form-label" for="subcategory">Subkategoria</label>
                        <input type="text" id="subcategory" class="form-input" placeholder="Wpisz subkategoriƒô">
                    </div>

                    <!-- Company (for Firmowe) -->
                    <div class="form-group hidden" id="companyGroup">
                        <label class="form-label" for="company">Firma</label>
                        <select id="company" class="form-select">
                            <option value="MT HUB">MT HUB</option>
                            <option value="FHU">FHU</option>
                        </select>
                    </div>

                    <!-- Date -->
                    <div class="form-group">
                        <label class="form-label" for="expenseDate">Data</label>
                        <input type="date" id="expenseDate" class="form-input" required>
                    </div>

                    <!-- Expense Type -->
                    <div class="form-group">
                        <label class="form-label">Rodzaj wydatku</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="isPayment" class="checkbox-input">
                                <span class="checkbox-text">Op≈Çata</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="isOther" class="checkbox-input" checked>
                                <span class="checkbox-text">Inne</span>
                            </label>
                        </div>
                    </div>

                    <!-- Payment Type (for Op≈Çata) -->
                    <div class="form-group hidden" id="paymentTypeGroup">
                        <label class="form-label" for="paymentType">Typ op≈Çaty</label>
                        <select id="paymentType" class="form-select">
                            <option value="ZUS">ZUS</option>
                            <option value="Dochodowy">Dochodowy</option>
                            <option value="VAT">VAT</option>
                        </select>
                    </div>

                    <!-- Description (for Inne) -->
                    <div class="form-group" id="descriptionGroup">
                        <label class="form-label" for="description">Opis</label>
                        <input type="text" id="description" class="form-input" placeholder="Opis wydatku">
                    </div>

                    <!-- Amount -->
                    <div class="form-group">
                    <label class="form-label" for="amount">Kwota (PLN)</label>
                    <input type="tel" 
                        id="amount" 
                        class="form-input" 
                        pattern="[0-9]*\.?[0-9]*" 
                        inputmode="decimal"
                        placeholder="0.00" 
                        required>
                </div>

                    <!-- Submit Button -->
                    <button type="submit" class="submit-button">
                        <span class="submit-text">Dodaj wydatek</span>
                        <svg class="submit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="/js/config.js?v2"></script>
    <script src="/js/utils.js?v2"></script>
    <script src="/js/api.js?v2"></script>
    <script src="/js/haptic.js?v2"></script>
    <script src="/js/yearly-chart.js?v2"></script>
    <script src="/js/expense-form.js?v2.2"></script>
    <script src="/js/dashboard.js?v2.1"></script>
    <script src="/js/app.js?v2"></script>
</body>
</html>